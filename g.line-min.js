/*!
 * g.Raphael 0.5 - Charting library, based on Raphaël
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Copyright (c) 2011 Karol Kowalski
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.fn.linechart=function(q,s,p,o,e,h,f){function L(n,b){for(var c=n.length/b,d=0,a=c,g=0,e=[];d<n.length;)a--,a<0?(g+=n[d]*(1+a),e.push(g/c),g=n[d++]*-a,a+=c):g+=n[d++];return e}function P(n,b,c,d,a,g){var e=(c-n)/2,h=(a-c)/2,n=Math.atan((c-n)/Math.abs(d-b)),a=Math.atan((a-c)/Math.abs(d-g)),n=b<d?Math.PI-n:n,a=g<d?Math.PI-a:a,g=Math.PI/2-(n+a)%(Math.PI*2)/2,b=e*Math.sin(g+n);e*=Math.cos(g+n);n=h*Math.sin(g+a);h*=Math.cos(g+a);return{x1:c-b,y1:d+e,x2:c+n,y2:d+h}}function D(a){for(var t=[],
c=0,d=e.length;c<d;c++)t=t.concat(e[c]);t.sort();var f=[],g=[];for(c=0,d=t.length;c<d;c++)t[c]!=t[c-1]&&f.push(t[c])&&g.push(q+b+(t[c]-w)*z);for(var t=f,d=t.length,k=a||r.set(),c=0;c<d;c++){var f=g[c]-(g[c]-(g[c-1]||q))/2,j=((g[c+1]||q+p)-g[c])/2+(g[c]-(g[c-1]||q))/2,i;a?i={}:k.push(i=r.rect(f-1,s,Math.max(j+1,1),o).attr({stroke:"none",fill:"#000",opacity:0}));i.values=[];i.symbols=r.set();i.y=[];i.x=g[c];i.axis=t[c];for(var j=0,v=h.length;j<v;j++)for(var f=e[j]||e[0],m=0,x=f.length;m<x;m++)f[m]==
t[c]&&(i.values.push(h[j][m]),i.y.push(s+o-b-(h[j][m]-y)*C),i.symbols.push(l.symbols[j][m]));a&&a.call(i)}!a&&(u=k)}function G(a){for(var f=a||r.set(),c,d=0,i=h.length;d<i;d++)for(var g=0,j=h[d].length;g<j;g++){var k=q+b+((e[d]||e[0])[g]-w)*z,m=q+b+((e[d]||e[0])[g?g-1:1]-w)*z,p=s+o-b-(h[d][g]-y)*C;a?c={}:f.push(c=r.circle(k,p,Math.abs(m-k)/2).attr({stroke:"none",fill:"#000",opacity:0}));c.x=k;c.y=p;c.value=h[d][g];c.line=l.lines[d];c.shade=l.shades[d];c.symbol=l.symbols[d][g];c.symbols=l.symbols[d];
c.axis=(e[d]||e[0])[g];a&&a.call(c)}!a&&(A=f)}f=f||{};Raphael.is(e[0],"array")||(e=[e]);Raphael.is(h[0],"array")||(h=[h]);for(var r=this.paper,b=f.gutter||10,j=Math.max(e[0].length,h[0].length),H=f.symbol||"",I=f.colors||this.colors,u=null,A=null,l=r.set(),k=[],a=0,v=h.length;a<v;a++)j=Math.max(j,h[a].length);var E=r.set();for(a=0,v=h.length;a<v;a++)f.shade&&E.push(r.path().attr({stroke:"none",fill:I[a],opacity:f.nostroke?1:0.3})),h[a].length>p-2*b&&(h[a]=L(h[a],p-2*b),j=p-2*b),e[a]&&e[a].length>
p-2*b&&(e[a]=L(e[a],p-2*b));var k=Array.prototype.concat.apply([],e),j=Array.prototype.concat.apply([],h),k=this.snapEnds(Math.min.apply(Math,k),Math.max.apply(Math,k),e[0].length-1),w=k.from,k=k.to,j=this.snapEnds(Math.min.apply(Math,j),Math.max.apply(Math,j),h[0].length-1),y=j.from,a=j.to,z=(p-b*2)/(k-w||1),C=(o-b*2)/(a-y||1),j=r.set();f.axis&&(v=(f.axis+"").split(/[,\s]+/),+v[0]&&j.push(this.axis(q+b,s+b,p-2*b,w,k,f.axisxstep||Math.floor((p-2*b)/20),2)),+v[1]&&j.push(this.axis(q+p-b,s+o-b,o-2*
b,y,a,f.axisystep||Math.floor((o-2*b)/20),3)),+v[2]&&j.push(this.axis(q+b,s+o-b,p-2*b,w,k,f.axisxstep||Math.floor((p-2*b)/20),0)),+v[3]&&j.push(this.axis(q+b,s+o-b,o-2*b,y,a,f.axisystep||Math.floor((o-2*b)/20),1)));var J=r.set(),K=r.set(),M;for(a=0,v=h.length;a<v;a++){f.nostroke||J.push(M=r.path().attr({stroke:I[a],"stroke-width":f.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":f.dash||""}));for(var B=Raphael.is(H,"array")?H[a]:H,N=r.set(),k=[],i=0,O=h[a].length;i<
O;i++){var m=q+b+((e[a]||e[0])[i]-w)*z,x=s+o-b-(h[a][i]-y)*C;(Raphael.is(B,"array")?B[i]:B)&&N.push(this[this.markers[Raphael.is(B,"array")?B[i]:B]](m,x,(f.width||2)*3).attr({fill:I[a],stroke:"none"}));if(f.smooth){if(i&&i!=O-1)var F=P(q+b+((e[a]||e[0])[i-1]-w)*z,s+o-b-(h[a][i-1]-y)*C,m,x,q+b+((e[a]||e[0])[i+1]-w)*z,s+o-b-(h[a][i+1]-y)*C),k=k.concat([F.x1,F.y1,m,x,F.x2,F.y2]);i||(k=["M",m,x,"C",m,x])}else k=k.concat([i?"L":"M",m,x])}f.smooth&&(k=k.concat([m,x,m,x]));K.push(N);f.shade&&E[a].attr({path:k.concat(["L",
m,s+o-b,"L",q+b+((e[a]||e[0])[0]-w)*z,s+o-b,"z"]).join(",")});!f.nostroke&&M.attr({path:k.join(",")})}l.push(J,E,K,j,u,A);l.lines=J;l.shades=E;l.symbols=K;l.axis=j;l.hoverColumn=function(a,b){!u&&D();u.mouseover(a).mouseout(b);return this};l.clickColumn=function(a){!u&&D();u.click(a);return this};l.hrefColumn=function(a){var b=Raphael.is(arguments[0],"array")?arguments[0]:arguments;if(!(arguments.length-1)&&typeof a=="object")for(var c in a)for(var d=0,e=u.length;d<e;d++)u[d].axis==c&&u[d].attr("href",
a[c]);!u&&D();for(d=0,e=b.length;d<e;d++)u[d]&&u[d].attr("href",b[d]);return this};l.hover=function(a,b){!A&&G();A.mouseover(a).mouseout(b);return this};l.click=function(a){!A&&G();A.click(a);return this};l.each=function(a){G(a);return this};l.eachColumn=function(a){D(a);return this};return l};