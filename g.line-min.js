/*
 * g.Raphael 0.4.2 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.linechart=function(N,M,c,ab,t,s,G){function D(Y,ae){var i=Y.length/ae,x=0,a=i,X=0,y=[];while(x<Y.length){a--;if(a<0){X+=Y[x]*(1+a);y.push(X/i);X=Y[x++]*-a;a+=i}else{X+=Y[x++]}}return y}function Q(j,i,aj,ah,ae,Y){var y=(aj-j)/2,x=(ae-aj)/2,ak=Math.atan((aj-j)/Math.abs(ah-i)),ai=Math.atan((ae-aj)/Math.abs(ah-Y));ak=i<ah?Math.PI-ak:ak;ai=Y<ah?Math.PI-ai:ai;var X=Math.PI/2-((ak+ai)%(Math.PI*2))/2,am=y*Math.sin(X+ak),ag=y*Math.cos(X+ak),al=x*Math.sin(X+ai),af=x*Math.cos(X+ai);return{x1:aj-am,y1:ah+ag,x2:aj+al,y2:ah+af}}G=G||{};if(!this.raphael.is(t[0],"array")){t=[t]}if(!this.raphael.is(s[0],"array")){s=[s]}var R=G.gutter||10,v=Math.max(t[0].length,s[0].length),K=G.symbol||"",n=G.colors||Raphael.fn.g.gencolors(v),L=this,q=null,m=null,ac=this.set(),T=[];for(var aa=0,H=s.length;aa<H;aa++){v=Math.max(v,s[aa].length)}var b=this.set();for(aa=0,H=s.length;aa<H;aa++){if(G.shade){b.push(this.path().attr({stroke:"none",fill:n[aa],opacity:G.nostroke?1:0.3}))}if(s[aa].length>c-2*R){s[aa]=D(s[aa],c-2*R);v=c-2*R}if(t[aa]&&t[aa].length>c-2*R){t[aa]=D(t[aa],c-2*R)}}var U=Array.prototype.concat.apply([],t),S=Array.prototype.concat.apply([],s),p=this.g.snapEnds(Math.min.apply(Math,U),Math.max.apply(Math,U),t[0].length-1),A=p.from,k=p.to,J=this.g.snapEnds(Math.min.apply(Math,S),Math.max.apply(Math,S),s[0].length-1),w=J.from,g=J.to,W=(c-R*2)/((k-A)||1),V=(ab-R*2)/((g-w)||1);var C=this.set();if(G.axis){var h=(G.axis+"").split(/[,\s]+/);+h[0]&&C.push(this.g.axis(N+R,M+R,c-2*R,A,k,G.axisxstep||Math.floor((c-2*R)/20),2));+h[1]&&C.push(this.g.axis(N+c-R,M+ab-R,ab-2*R,w,g,G.axisystep||Math.floor((ab-2*R)/20),3));+h[2]&&C.push(this.g.axis(N+R,M+ab-R,c-2*R,A,k,G.axisxstep||Math.floor((c-2*R)/20),0));+h[3]&&C.push(this.g.axis(N+R,M+ab-R,ab-2*R,w,g,G.axisystep||Math.floor((ab-2*R)/20),1))}var I=this.set(),l=this.set(),o;for(aa=0,H=s.length;aa<H;aa++){if(!G.nostroke){I.push(o=this.path().attr({stroke:n[aa],"stroke-width":G.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":G.dash||""}))}var d=this.raphael.is(K,"array")?K[aa]:K,E=this.set();T=[];for(var Z=0,r=s[aa].length;Z<r;Z++){var f=N+R+((t[aa]||t[0])[Z]-A)*W,e=M+ab-R-(s[aa][Z]-w)*V;(Raphael.is(d,"array")?d[Z]:d)&&E.push(this.g[Raphael.fn.g.markers[this.raphael.is(d,"array")?d[Z]:d]](f,e,(G.width||2)*3).attr({fill:n[aa],stroke:"none"}));if(G.smooth){if(Z&&Z!=r-1){var P=N+R+((t[aa]||t[0])[Z-1]-A)*W,B=M+ab-R-(s[aa][Z-1]-w)*V,O=N+R+((t[aa]||t[0])[Z+1]-A)*W,z=M+ab-R-(s[aa][Z+1]-w)*V;var ad=Q(P,B,f,e,O,z);T=T.concat([ad.x1,ad.y1,f,e,ad.x2,ad.y2])}if(!Z){T=["M",f,e,"C",f,e]}}else{T=T.concat([Z?"L":"M",f,e])}}if(G.smooth){T=T.concat([f,e,f,e])}l.push(E);if(G.shade){b[aa].attr({path:T.concat(["L",f,M+ab-R,"L",N+R+((t[aa]||t[0])[0]-A)*W,M+ab-R,"z"]).join(",")})}!G.nostroke&&o.attr({path:T.join(",")})}function u(ak){var ah=[];for(var ai=0,am=t.length;ai<am;ai++){ah=ah.concat(t[ai])}ah.sort();var an=[],ae=[];for(ai=0,am=ah.length;ai<am;ai++){ah[ai]!=ah[ai-1]&&an.push(ah[ai])&&ae.push(N+R+(ah[ai]-A)*W)}ah=an;am=ah.length;var y=ak||L.set();for(ai=0;ai<am;ai++){var Y=ae[ai]-(ae[ai]-(ae[ai-1]||N))/2,al=((ae[ai+1]||N+c)-ae[ai])/2+(ae[ai]-(ae[ai-1]||N))/2,a;ak?(a={}):y.push(a=L.rect(Y-1,M,Math.max(al+1,1),ab).attr({stroke:"none",fill:"#000",opacity:0}));a.values=[];a.symbols=L.set();a.y=[];a.x=ae[ai];a.axis=ah[ai];for(var ag=0,aj=s.length;ag<aj;ag++){an=t[ag]||t[0];for(var af=0,x=an.length;af<x;af++){if(an[af]==ah[ai]){a.values.push(s[ag][af]);a.y.push(M+ab-R-(s[ag][af]-w)*V);a.symbols.push(ac.symbols[ag][af])}}}ak&&ak.call(a)}!ak&&(q=y)}function F(ai){var y=ai||L.set(),a;for(var ag=0,ak=s.length;ag<ak;ag++){for(var af=0,ah=s[ag].length;af<ah;af++){var ae=N+R+((t[ag]||t[0])[af]-A)*W,aj=N+R+((t[ag]||t[0])[af?af-1:1]-A)*W,x=M+ab-R-(s[ag][af]-w)*V;ai?(a={}):y.push(a=L.circle(ae,x,Math.abs(aj-ae)/2).attr({stroke:"none",fill:"#000",opacity:0}));a.x=ae;a.y=x;a.value=s[ag][af];a.line=ac.lines[ag];a.shade=ac.shades[ag];a.symbol=ac.symbols[ag][af];a.symbols=ac.symbols[ag];a.axis=(t[ag]||t[0])[af];ai&&ai.call(a)}}!ai&&(m=y)}ac.push(I,b,l,C,q,m);ac.lines=I;ac.shades=b;ac.symbols=l;ac.axis=C;ac.hoverColumn=function(i,a){!q&&u();q.mouseover(i).mouseout(a);return this};ac.clickColumn=function(a){!q&&u();q.click(a);return this};ac.hrefColumn=function(X){var Y=L.raphael.is(arguments[0],"array")?arguments[0]:arguments;if(!(arguments.length-1)&&typeof X=="object"){for(var a in X){for(var j=0,y=q.length;j<y;j++){if(q[j].axis==a){q[j].attr("href",X[a])}}}}!q&&u();for(j=0,y=Y.length;j<y;j++){q[j]&&q[j].attr("href",Y[j])}return this};ac.hover=function(i,a){!m&&F();m.mouseover(i).mouseout(a);return this};ac.click=function(a){!m&&F();m.click(a);return this};ac.each=function(a){F(a);return this};ac.eachColumn=function(a){u(a);return this};return ac};