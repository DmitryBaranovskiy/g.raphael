/*
 * g.Raphael 0.2 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */


Raphael.fn.g.linechart=function(g,f,A,C,Q,P,Z){function W(i,x){var Y=i.length/x,u=0,X=Y,w=0,v=[];while(u<i.length){X--;if(X<0){w+=i[u]*(1+X);v.push(w/Y);w=i[u++]*-X;X+=Y;}else{w+=i[u++];}}return v;}Z=Z||{};if(!this.raphael.isArray(Q[0])){Q=[Q];}if(!this.raphael.isArray(P[0])){P=[P];}var n=Array.prototype.concat.apply([],Q),l=Array.prototype.concat.apply([],P),M=this.g.snapEnds(Math.min.apply(Math,n),Math.max.apply(Math,n),Q[0].length-1),T=M.from,H=M.to,J=Z.gutter||10,o=(A-J*2)/(H-T),d=this.g.snapEnds(Math.min.apply(Math,l),Math.max.apply(Math,l),P[0].length-1),S=d.from,G=d.to,m=(C-J*2)/(G-S),R=Math.max(Q[0].length,P[0].length),L=Z.symbol||"",h=Z.colors||Raphael.fn.g.colors,e=this,N=null,I=null,s=this.set(),k=[];for(var r=0,b=P.length;r<b;r++){R=Math.max(R,P[r].length);}var t=this.set();for(var r=0,b=P.length;r<b;r++){if(Z.shade){t.push(this.path({stroke:"none",fill:h[r],opacity:Z.nostroke?1:0.3}));}if(P[r].length>A-2*J){P[r]=W(P[r],A-2*J);R=A-2*J;}if(Q[r]&&Q[r].length>A-2*J){Q[r]=W(Q[r],A-2*J);}}var U=this.set();if(Z.axis){var F=(Z.axis+"").split(/[,\s]+/);+F[0]&&U.push(this.g.axis(g+J,f+J,A-2*J,T,H,Z.axisxstep||Math.floor((A-2*J)/20),2));+F[1]&&U.push(this.g.axis(g+A-J,f+C-J,C-2*J,S,G,Z.axisystep||Math.floor((C-2*J)/20),3));+F[2]&&U.push(this.g.axis(g+J,f+C-J,A-2*J,T,H,Z.axisxstep||Math.floor((A-2*J)/20),0));+F[3]&&U.push(this.g.axis(g+J,f+C-J,C-2*J,S,G,Z.axisystep||Math.floor((C-2*J)/20),1));}var c=this.set(),p=this.set(),K;for(var r=0,b=P.length;r<b;r++){if(!Z.nostroke){c.push(K=this.path({stroke:h[r],"stroke-width":Z.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":Z.dash||""}));}var B=this.raphael.isArray(L)?L[r]:L;k=[];for(var q=0,O=P[r].length;q<O;q++){var E=g+J+((Q[r]||Q[0])[q]-T)*o;var D=f+C-J-(P[r][q]-S)*m;(Raphael.isArray(B)?B[q]:B)&&p.push(this.g[Raphael.fn.g.markers[this.raphael.isArray(B)?B[q]:B]](E,D,(Z.width||2)*3).attr({fill:h[r],stroke:"none"}));k=k.concat([q?"L":"M",E,D]);}if(Z.shade){t[r].attr({path:k.concat(["L",E,f+C-J,"L",g+J+((Q[r]||Q[0])[0]-T)*o,f+C-J,"z"]).join(",")});}!Z.nostroke&&K.attr({path:k.join(",")});}function a(){var AB=[];for(var AC=0,AF=Q.length;AC<AF;AC++){AB=AB.concat(Q[AC]);}AB.sort();var AG=[],y=[];for(var AC=0,AF=AB.length;AC<AF;AC++){AB[AC]!=AB[AC-1]&&AG.push(AB[AC])&&y.push(g+J+(AB[AC]-T)*o);}AB=AG;AF=AB.length;var x=e.set();for(var AC=0;AC<AF;AC++){var v=y[AC]-(y[AC]-(y[AC-1]||g))/2,AE=((y[AC+1]||g+A)-y[AC])/2+(y[AC]-(y[AC-1]||g))/2,Y;x.push(Y=e.rect(v-1,f,AE+1,C).attr({stroke:"none",fill:"#000",opacity:0}));Y.values=[];Y.y=[];Y.x=y[AC];Y.axis=AB[AC];for(var AA=0,AD=P.length;AA<AD;AA++){AG=Q[AA]||Q[0];for(var z=0,u=AG.length;z<u;z++){if(AG[z]==AB[AC]){Y.values.push(P[AA][z]);Y.y.push(f+C-J-(P[AA][z]-S)*m);}}}}N=x;}function V(){var x=e.set(),u;for(var z=0,AC=P.length;z<AC;z++){for(var y=0,AA=P[z].length;y<AA;y++){var w=g+J+((Q[z]||Q[0])[y]-T)*o,AB=g+J+((Q[z]||Q[0])[y?y-1:1]-T)*o,v=f+C-J-(P[z][y]-S)*m;x.push(u=e.circle(w,v,Math.abs(AB-w)/2).attr({stroke:"none",fill:"#000",opacity:0}));u.x=w;u.y=v;u.value=P[z][y];u.axis=(Q[z]||Q[0])[y];}}I=x;}s.push(U,N,I,c,t,p);s.hoverColumn=function(Y,X){!N&&a();N.mouseover(Y).mouseout(X);return this;};s.clickColumn=function(X){!N&&a();N.click(X);return this;};s.hrefColumn=function(u){var v=e.raphael.isArray(arguments[0])?arguments[0]:arguments;if(!(arguments.length-1)&&typeof u=="object"){for(var X in u){for(var Y=0,j=N.length;Y<j;Y++){if(N[Y].axis==X){N[Y].attr("href",u[X]);}}}}!N&&a();for(var Y=0,j=v.length;Y<j;Y++){N[Y]&&N[Y].attr("href",v[Y]);}return this;};s.hoverDot=function(Y,X){!I&&V();I.mouseover(Y).mouseout(X);return this;};s.clickDot=function(X){!I&&V();I.click(X);return this;};return s;};