/*!
 * g.Raphael 0.4.2 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.linechart=function(N,M,b,d,t,s,G){function E(x,af){var i=x.length/af,y=0,a=i,Y=0,X=[];while(y<x.length){a--;if(a<0){Y+=x[y]*(1+a);X.push(Y/i);Y=x[y++]*-a;a+=i}else{Y+=x[y++]}}return X}function Q(j,i,ak,ai,af,Y){var y=(ak-j)/2,x=(af-ak)/2,al=Math.atan((ak-j)/Math.abs(ai-i)),aj=Math.atan((af-ak)/Math.abs(ai-Y));al=i<ai?Math.PI-al:al;aj=Y<ai?Math.PI-aj:aj;var X=Math.PI/2-((al+aj)%(Math.PI*2))/2,an=y*Math.sin(X+al),ah=y*Math.cos(X+al),am=x*Math.sin(X+aj),ag=x*Math.cos(X+aj);return{x1:ak-an,y1:ai+ah,x2:ak+am,y2:ai+ag}}G=G||{};if(!this.raphael.is(t[0],"array")){t=[t]}if(!this.raphael.is(s[0],"array")){s=[s]}var m=G.gutter||10,u=Math.max(t[0].length,s[0].length),o=G.symbol||"",R=G.colors||Raphael.fn.g.colors,L=this,q=null,l=null,ac=this.set(),S=[];for(var ab=0,I=s.length;ab<I;ab++){u=Math.max(u,s[ab].length)}var ad=this.set();for(ab=0,I=s.length;ab<I;ab++){if(G.shade){ad.push(this.path().attr({stroke:"none",fill:R[ab],opacity:G.nostroke?1:0.3}))}if(s[ab].length>b-2*m){s[ab]=E(s[ab],b-2*m);u=b-2*m}if(t[ab]&&t[ab].length>b-2*m){t[ab]=E(t[ab],b-2*m)}}var V=Array.prototype.concat.apply([],t),T=Array.prototype.concat.apply([],s),p=this.g.snapEnds(Math.min.apply(Math,V),Math.max.apply(Math,V),t[0].length-1),z="minx" in G?G.minx:p.from,k="maxx" in G?G.maxx:p.to,K=this.g.snapEnds(Math.min.apply(Math,T),Math.max.apply(Math,T),s[0].length-1),v="miny" in G?G.miny:K.from,h="maxy" in G?G.maxy:K.to,W=(b-m*2)/((k-z)||1),U=(d-m*2)/((h-v)||1);var B=this.set();if(G.axis){var F=G.axislabels||[];var g=(G.axis+"").split(/[,\s]+/);+g[0]&&B.push(this.g.axis(N+m,M+m,b-2*m,z,k,G.axisxstep||Math.floor((b-2*m)/20),2,F[0]));+g[1]&&B.push(this.g.axis(N+b-m,M+d-m,d-2*m,v,h,G.axisystep||Math.floor((d-2*m)/20),3,F[1]));+g[2]&&B.push(this.g.axis(N+m,M+d-m,b-2*m,z,k,G.axisxstep||Math.floor((b-2*m)/20),0,F[2]));+g[3]&&B.push(this.g.axis(N+m,M+d-m,d-2*m,v,h,G.axisystep||Math.floor((d-2*m)/20),1,F[3]))}var J=this.set(),Z=this.set(),n;for(ab=0,I=s.length;ab<I;ab++){if(!G.nostroke){J.push(n=this.path().attr({stroke:R[ab],"stroke-width":G.width||2,"stroke-linejoin":"round","stroke-linecap":"round","stroke-dasharray":G.dash||""}))}var c=this.raphael.is(o,"array")?o[ab]:o,C=this.set();S=[];for(var aa=0,r=s[ab].length;aa<r;aa++){var f=N+m+((t[ab]||t[0])[aa]-z)*W,e=M+d-m-(s[ab][aa]-v)*U;(Raphael.is(c,"array")?c[aa]:c)&&C.push(Raphael.is((Raphael.is(c,"array")?c[aa]:c),"function")?(Raphael.is(c,"array")?c[aa]:c).call(this,f,e,R[ab]):this.g[Raphael.fn.g.markers[this.raphael.is(c,"array")?c[aa]:c]](f,e,(G.width||2)*3).attr({fill:R[ab],stroke:"none"}));if(G.smooth){if(aa&&aa!=r-1){var P=N+m+((t[ab]||t[0])[aa-1]-z)*W,A=M+d-m-(s[ab][aa-1]-v)*U,O=N+m+((t[ab]||t[0])[aa+1]-z)*W,w=M+d-m-(s[ab][aa+1]-v)*U;var ae=Q(P,A,f,e,O,w);S=S.concat([ae.x1,ae.y1,f,e,ae.x2,ae.y2])}if(!aa){S=["M",f,e,"C",f,e]}}else{S=S.concat([aa?"L":"M",f,e])}}if(G.smooth){S=S.concat([f,e,f,e])}Z.push(C);if(G.shade){ad[ab].attr({path:S.concat(["L",f,M+d-m,"L",N+m+((t[ab]||t[0])[0]-z)*W,M+d-m,"z"]).join(",")})}!G.nostroke&&n.attr({path:S.join(",")})}function H(al){var ai=[];for(var aj=0,an=t.length;aj<an;aj++){ai=ai.concat(t[aj])}ai.sort();var ao=[],af=[];for(aj=0,an=ai.length;aj<an;aj++){ai[aj]!=ai[aj-1]&&ao.push(ai[aj])&&af.push(N+m+(ai[aj]-z)*W)}ai=ao;an=ai.length;var Y=al||L.set();for(aj=0;aj<an;aj++){var y=af[aj]-(af[aj]-(af[aj-1]||N))/2,am=((af[aj+1]||N+b)-af[aj])/2+(af[aj]-(af[aj-1]||N))/2,a;al?(a={}):Y.push(a=L.rect(y-1,M,Math.max(am+1,1),d).attr({stroke:"none",fill:"#000",opacity:0}));a.values=[];a.symbols=L.set();a.y=[];a.x=af[aj];a.axis=ai[aj];for(var ah=0,ak=s.length;ah<ak;ah++){ao=t[ah]||t[0];for(var ag=0,x=ao.length;ag<x;ag++){if(ao[ag]==ai[aj]){a.values.push(s[ah][ag]);a.y.push(M+d-m-(s[ah][ag]-v)*U);a.symbols.push(ac.symbols[ah][ag])}}}al&&al.call(a)}!al&&(q=Y)}function D(aj){var af=aj||L.set(),a;for(var ah=0,al=s.length;ah<al;ah++){for(var ag=0,ai=s[ah].length;ag<ai;ag++){var y=N+m+((t[ah]||t[0])[ag]-z)*W,ak=N+m+((t[ah]||t[0])[ag?ag-1:1]-z)*W,x=M+d-m-(s[ah][ag]-v)*U;aj?(a={}):af.push(a=L.circle(y,x,Math.abs(ak-y)/2).attr({stroke:"none",fill:"#000",opacity:0}));a.x=y;a.y=x;a.value=s[ah][ag];a.line=ac.lines[ah];a.shade=ac.shades[ah];a.symbol=ac.symbols[ah][ag];a.symbols=ac.symbols[ah];a.axis=(t[ah]||t[0])[ag];aj&&aj.call(a)}}!aj&&(l=af)}ac.push(J,ad,Z,B,q,l);ac.lines=J;ac.shades=ad;ac.symbols=Z;ac.axis=B;ac.hoverColumn=function(i,a){!q&&H();q.mouseover(i).mouseout(a);return this};ac.clickColumn=function(a){!q&&H();q.click(a);return this};ac.hrefColumn=function(X){var Y=L.raphael.is(arguments[0],"array")?arguments[0]:arguments;if(!(arguments.length-1)&&typeof X=="object"){for(var a in X){for(var j=0,y=q.length;j<y;j++){if(q[j].axis==a){q[j].attr("href",X[a])}}}}!q&&H();for(j=0,y=Y.length;j<y;j++){q[j]&&q[j].attr("href",Y[j])}return this};ac.hover=function(i,a){!l&&D();l.mouseover(i).mouseout(a);return this};ac.click=function(a){!l&&D();l.click(a);return this};ac.each=function(a){D(a);return this};ac.eachColumn=function(a){H(a);return this};return ac};