/*
 * g.Raphael 0.4.1 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.fn.g.barchart=function(o,n,D,N,p,u){u=u||{};var f={round:"round",sharp:"sharp",soft:"soft"}[u.type]||"square",m=parseFloat(u.gutter||"20%"),z=this.set(),C=this.set(),e=this.set(),G=this.set(),O=Math.max.apply(Math,p),a=[],q=this,E=0,K=p.length;colors=u.colors||this.g.gencolors(K);if(this.raphael.is(p[0],"array")){O=[];K=0;E=K;for(var I=p.length;I--;){C.push(this.set());O.push(Math.max.apply(Math,p[I]));K=Math.max(K,p[I].length)}if(u.stacked){for(var I=K;I--;){var r=0;for(var H=p.length;H--;){r+=+p[H][I]||0}a.push(r)}}for(var I=p.length;I--;){if(p[I].length<K){for(var H=K;H--;){p[I].push(0)}}}O=Math.max.apply(Math,u.stacked?a:O)}O=(u.to)||O;var k=D/(K*(100+m)+m)*100,d=k*m/100,g=u.vgutter==null?20:u.vgutter,l=[],c=o+d,b=(N-2*g)/O;if(!u.stretch){d=Math.round(d);k=Math.floor(k)}!u.stacked&&(k/=E||1);for(var I=0;I<K;I++){l=[];for(var H=0;H<(E||1);H++){var J=Math.round((E?p[H][I]:p[I])*b),w=n+N-g-J,L=this.g.finger(Math.round(c+k/2),w+J,k,J,true,f).attr({stroke:"none",fill:colors[E?H:I]});if(E){C[H].push(L)}else{C.push(L)}L.y=w;L.x=Math.round(c+k/2);L.w=k;L.h=J;L.value=E?p[H][I]:p[I];if(!u.stacked){c+=k}else{l.push(L)}}if(u.stacked){var t;G.push(t=this.rect(l[0].x-l[0].w/2,n,k,N).attr(this.g.shim));t.bars=this.set();var A=0;for(var v=l.length;v--;){l[v].toFront()}for(var v=0,F=l.length;v<F;v++){var L=l[v],M,J=(A+L.value)*b,B=this.g.finger(L.x,n+N-g-!!A*0.5,k,J,true,f,1);t.bars.push(L);A&&L.attr({path:B});L.h=J;L.y=n+N-g-!!A*0.5-J;e.push(M=this.rect(L.x-L.w/2,L.y,k,L.value*b).attr(this.g.shim));M.bar=L;M.value=L.value;A+=L.value}c+=k}c+=d}G.toFront();c=o+d;if(!u.stacked){for(var I=0;I<K;I++){for(var H=0;H<(E||1);H++){var M;e.push(M=this.rect(Math.round(c),n+g,k,N-g).attr(this.g.shim));M.bar=E?C[H][I]:C[I];M.value=M.bar.value;c+=k}c+=d}}z.label=function(s,h){s=s||[];this.labels=q.set();var S,x=-Infinity;if(u.stacked){for(var P=0;P<K;P++){var Q=0;for(var y=0;y<(E||1);y++){Q+=E?p[y][P]:p[P];if(y==E-1){var T=q.g.labelise(s[P],Q,O);S=q.g.text(C[P*(E||1)+y].x,n+N-g/2,T).insertBefore(e[P*(E||1)+y]);var R=S.getBBox();if(R.x-7<x){S.remove()}else{this.labels.push(S);x=R.x+R.width}}}}}else{for(var P=0;P<K;P++){for(var y=0;y<(E||1);y++){var T=q.g.labelise(E?s[y]&&s[y][P]:s[P],E?p[y][P]:p[P],O);S=q.g.text(C[P*(E||1)+y].x,h?n+N-g/2:C[P*(E||1)+y].y-10,T).insertBefore(e[P*(E||1)+y]);var R=S.getBBox();if(R.x-7<x){S.remove()}else{this.labels.push(S);x=R.x+R.width}}}}return this};z.hover=function(i,h){G.hide();e.show();e.mouseover(i).mouseout(h);return this};z.hoverColumn=function(i,h){e.hide();G.show();h=h||function(){};G.mouseover(i).mouseout(h);return this};z.click=function(h){G.hide();e.show();e.click(h);return this};z.each=function(j){if(!Raphael.is(j,"function")){return this}for(var h=e.length;h--;){j.call(e[h])}return this};z.eachColumn=function(j){if(!Raphael.is(j,"function")){return this}for(var h=G.length;h--;){j.call(G[h])}return this};z.clickColumn=function(h){e.hide();G.show();G.click(h);return this};z.push(C,e,G);z.bars=C;z.covers=e;return z};Raphael.fn.g.hbarchart=function(l,k,z,J,m,q){q=q||{};var e={round:"round",sharp:"sharp",soft:"soft"}[q.type]||"square",g=parseFloat(q.gutter||"20%"),t=this.set(),w=this.set(),d=this.set(),C=this.set(),L=Math.max.apply(Math,m),a=[],n=this,A=0,F=m.length;colors=q.colors||this.g.gencolors(F);if(this.raphael.is(m[0],"array")){L=[];A=F;F=0;for(var E=m.length;E--;){w.push(this.set());L.push(Math.max.apply(Math,m[E]));F=Math.max(F,m[E].length)}if(q.stacked){for(var E=F;E--;){var o=0;for(var D=m.length;D--;){o+=+m[D][E]||0}a.push(o)}}for(var E=m.length;E--;){if(m[E].length<F){for(var D=F;D--;){m[E].push(0)}}}L=Math.max.apply(Math,q.stacked?a:L)}L=(q.to)||L;var H=Math.floor(J/(F*(100+g)+g)*100),h=Math.floor(H*g/100),f=[],b=k+h,c=(z-1)/L;!q.stacked&&(H/=A||1);for(var E=0;E<F;E++){f=[];for(var D=0;D<(A||1);D++){var K=A?m[D][E]:m[E],G=this.g.finger(l,b+H/2,Math.round(K*c),H-1,false,e).attr({stroke:"none",fill:colors[A?D:E]});if(A){w[D].push(G)}else{w.push(G)}G.x=l+Math.round(K*c);G.y=b+H/2;G.w=Math.round(K*c);G.h=H;G.value=+K;if(!q.stacked){b+=H}else{f.push(G)}}if(q.stacked){var p=this.rect(l,f[0].y-f[0].h/2,z,H).attr(this.g.shim);C.push(p);p.bars=this.set();var u=0;for(var r=f.length;r--;){f[r].toFront()}for(var r=0,B=f.length;r<B;r++){var G=f[r],I,K=Math.round((u+G.value)*c),v=this.g.finger(l,G.y,K,H-1,false,e,1);p.bars.push(G);u&&G.attr({path:v});G.w=K;G.x=l+K;d.push(I=this.rect(l+u*c,G.y-G.h/2,G.value*c,H).attr(this.g.shim));I.bar=G;u+=G.value}b+=H}b+=h}C.toFront();b=k+h;if(!q.stacked){for(var E=0;E<F;E++){for(var D=0;D<(A||1);D++){var I=this.rect(l,b,z,H).attr(this.g.shim);d.push(I);I.bar=A?w[D][E]:w[E];I.value=I.bar.value;b+=H}b+=h}}t.label=function(P,O){P=P||[];this.labels=n.set();for(var N=0;N<F;N++){for(var M=0;M<A;M++){var y=n.g.labelise(A?P[M]&&P[M][N]:P[N],A?m[M][N]:m[N],L);var Q=O?w[N*(A||1)+M].x-H/2+3:l+5,x=O?"end":"start",s;this.labels.push(s=n.g.text(Q,w[N*(A||1)+M].y,y).attr({"text-anchor":x}).insertBefore(d[0]));if(s.getBBox().x<l+5){s.attr({x:l+5,"text-anchor":"start"})}else{w[N*(A||1)+M].label=s}}}return this};t.hover=function(j,i){C.hide();d.show();i=i||function(){};d.mouseover(j).mouseout(i);return this};t.hoverColumn=function(j,i){d.hide();C.show();i=i||function(){};C.mouseover(j).mouseout(i);return this};t.each=function(s){if(!Raphael.is(s,"function")){return this}for(var j=d.length;j--;){s.call(d[j])}return this};t.eachColumn=function(s){if(!Raphael.is(s,"function")){return this}for(var j=C.length;j--;){s.call(C[j])}return this};t.click=function(i){C.hide();d.show();d.click(i);return this};t.clickColumn=function(i){d.hide();C.show();C.click(i);return this};t.push(w,d,C);t.bars=w;t.covers=d;return t};